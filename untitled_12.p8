pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
--init
new_p=function(x,y)
	p={}
	p.x=x
	p.y=y
	p.dy=0--velocity
	p.d=8
	p.id=1
	
	p.draw=function(this)
		local thrv=0.4--threshold for changing
																--sprite change
		if this.dy<-thrv then
				spr(this.id+1,this.x,this.y)
		elseif this.dy>thrv then
				spr(this.id+2,this.x,this.y)
		else
				spr(this.id,this.x,this.y)
		end
	end
	
	p.update=function(this)
		--gravity
		local ga=0.05--gravity
		local ja=2--jump velocity
		local maxv=1
		this.dy+=ga
		--move character
		if btnp(âŽ) then
			this.dy-=ja
		end
		--update player position
		if this.dy>0 then
				this.dy=min(maxv,this.dy)
		else
				this.dy=max(-maxv,this.dy)
		end
		this.y+=this.dy
	end
	return p
end

new_pipe=function(x,y,top)
	pipe={}
	pipe.x=x
	pipe.y=y
	pipe.w=16
	pipe.h=128
	pipe.gap=32
	pipe.top=top--dir of pipe
	
	pipe.draw=function(this)
		--upwards pointing
		spr(64,this.x,this.y+this.gap/2,2,2)
		for i=1,16 do
			spr(96,this.x,this.y+i*8+this.gap/2,2,1)
		end
	
		--downwards pointing
		spr(82,this.x,this.y-16-this.gap/2,2,2)
		for i=1,16 do
			spr(66,this.x,this.y-i*8-16-this.gap/2,2,1)
		end	
	end
	pipe.update=function(this)
		if this.x+16<0 then
			--move pipe to random new location
			this.top=rnd({false,true})
			this.x+=128+rnd(128)
			this.y=rnd(128)
		end
		this.x-=0.5
	end
	return pipe
end

--setup game loop
function _init()
	floory=100
	score=0
	p=new_p(10,64)
	pipes={}
	for i=0,10 do
		add(pipes,new_pipe(128+i*64,rnd(128),rnd({false,true})))
	end
	upd=upd_game
	drw=drw_game
end

function _update60()
	upd()
end

function _draw()
	drw()
end
-->8
--draw
function drw_game()
	cls(12)
	for pipe in all(pipes) do
		pipe:draw()
	end
	--floor
	rectfill(0,floory,128,128,15)
	for i=0,16 do
		spr(68,i*8,floory)
	end
	p:draw()
end

function drw_game_over()
	cls(12)
	for pipe in all(pipes) do
		pipe:draw()
	end
	--floor
	rectfill(0,floory,128,128,15)
	for i=0,16 do
		spr(68,i*8,floory)
	end
	p:draw()
	--text
	print("game over",64-4.5*4,20,7)
	print("score:"..score,64-4.5*4,30,7)
end




-->8
--update
function upd_game()
	p:update()
	for pipe in all(pipes) do
		pipe:update()
		--check collision
		--x calc first
		if p.x+4>pipe.x and p.x<pipe.x+16 then
			if p.y<pipe.y-pipe.gap/2 then
				--collision
				set_game_over()
			end
			if p.y+8>pipe.y+pipe.gap/2 then
				--collision
				set_game_over()
			end
		end
	end
	if p.y+8<floory then
		set_game_over()
	end
end

function set_game_over()
	upd=upd_game_over
	drw=drw_game_over
end

function upd_game_over()
	--move player to floor
	if p.y+8<floory then
		p:update()
	end
end

__gfx__
000000000aaaa000000008000aaaaaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000aaaa6600002289809aaaaaaa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700aaa677200677898a9aaaaaaa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000aaa67720a677898a9a8a66aa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000aaaa8880aa66a8aa9898776a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007009aa899989aaaaaaa98987760000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000099aa888099aaaaaa08982200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000099999000999999000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
111111111111111101babb3b33535510111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1baaaaaababbbbb101babb3b33535510aaaaaaaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1babb3b33335355101babb3b33535510b33bb33b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1babb3b33335355101babb3b3353551033bb33bb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1babb3b33335355101babb3b335355103bb33bb30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1babb3b33335355101babb3b33535510bb33bb330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
13b332333335355101babb3b33535510b33bb33b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
111111111111111101babb3b33535510111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
013b33233353551001babb3b33535510000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01babb3b3353551001babb3b33535510000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01babb3b3353551001babb3b33535510000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01babb3b3353551001babb3b33535510000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01babb3b3353551001babb3b33535510000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01babb3b3353551001babb3b33535510000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01babb3b3353551001babb3b33535510000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01babb3b33535510013b332333535510000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01babb3b335355101111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01babb3b335355101baaaaaababbbbb1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01babb3b335355101babb3b333353551000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01babb3b335355101babb3b333353551000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01babb3b335355101babb3b333353551000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01babb3b335355101babb3b333353551000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01babb3b3353551013b3323333353551000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01babb3b335355101111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
