pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
function new_p(x,y)
	p={}
	p.x=x
	p.y=y
	p.dy=0
	p.draw=function(this)
		local thr=1
		if this.dy>thr then
			spr(3,this.x,this.y)
		elseif this.dy<-thr then
			spr(2,this.x,this.y)
		else
			spr(1,this.x,this.y)
		end
	end
	p.update=function(this)
		local ga=0.08
		local jv=-2
		if btnp(❎) then
			sfx(0)
			this.dy=jv
		end
		this.dy+=ga
		this.y+=this.dy
	end
	return p
end

function new_pipe(x,y)
	pipe={}
	pipe.x=x
	pipe.y=y
	pipe.gap=70
	pipe.draw=function(this)
		spr(82,this.x,this.y,2,1)
		for i=1,12 do
			spr(66,this.x,this.y-i*8,2,1)
		end
		spr(64,this.x,this.y+pipe_gap,2,1)
		for i=1,12 do
			spr(80,this.x,this.y+i*8+pipe_gap,2,1)
		end
	end
	pipe.update=function(this)
		this.x-=move_speed
		if this.x+16<0 then
			this.x+=#pipes*pipe_distance
		end
	end
	return pipe
end

function rndy()
	local miny=10
	return rnd(floory-pipe_gap)
end

function _init()
	score=0
	last_pipe=nil
	move_speed=0.6
	pipe_gap=60
	pipe_distance=60
	p=new_p(10,64)
	floory=100
	pipes={}
	for i=0,10 do
		add(pipes,new_pipe(200+i*pipe_distance,rndy()))
	end
	drw=draw_game
	upd=update_game
end

function _draw()
	drw()
end

function _update60()
	upd()
end
-->8
--draw
function draw_game()
	cls(12)
	p:draw()
	for pipe in all(pipes) do
		pipe:draw()
	end
	rectfill(0,floory,128,128,15)
	for i=0,16 do
		spr(68,i*8+pipes[1].x%8-8,floory)
	end
	print("score:"..score,56,20,7)

end

function draw_go()
	cls(12)
	p:draw()
	for pipe in all(pipes) do
		pipe:draw()
	end
	rectfill(0,floory,128,128,15)
	for i=0,16 do
		spr(68,i*8+pipes[1].x%8-8,floory)
	end
	print("game over",52,20,7)
	print("score"..score,56,30,7)
end
-->8
--update
function update_game()
	p:update()
	for pipe in all(pipes) do
		pipe:update()
		if p.x+6>pipe.x and p.x<pipe.x+16 then
			if p.y<pipe.y or p.y>pipe.y+pipe_gap then
				set_game_over()
			end
			if last_pipe!=pipe then
				score+=1
				last_pipe=pipe
			end
		end
		if p.y+8>floory then
			set_game_over()
		end
	end
end

function set_game_over()
	upd=update_go
	drw=draw_go
end

function update_go()
	if p.y+8<floory then
		p.dy+=0.1
		p.y+=p.dy
	end
end
__gfx__
00000000009999000099990009999990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000999977109977119099999990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700999977199977711899999779000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000999977199997778898977779000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000999977199997788888877719000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700999988889999888888887119000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000999888889998888888888190000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000099988880999888008888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111013ba3b333553510111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1baababbbbb33b31013ba3b333553510aaaaaaaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
13ba3b3333355351013ba3b33355351033333bb30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
13ba3b3333355351013ba3b3335535103333bb330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
13ba3b3333355351013ba3b333553510333bb3330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
13ba3b3333355351013ba3b33355351033bb33330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
153b535555555551013ba3b333553510533555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111111111111111013ba3b333553510111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
013ba3b3335535101111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
013ba3b333553510153b535555555551000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
013ba3b33355351013ba3b3333355351000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
013ba3b33355351013ba3b3333355351000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
013ba3b33355351013ba3b3333355351000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
013ba3b33355351013ba3b3333355351000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
013ba3b3335535101baababbbbb33b31000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
013ba3b3335535101111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
0001000038050300502c0501d05015050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
