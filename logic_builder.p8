pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
--init
function _init()
	mouse.init()
	init_gate_types()
	gates={}
end

mouse = {
	init = function()
	 poke(0x5f2d, 1)
	end,
	-- return int:x, int:y, onscreen:bool
	pos = function()
	 local x,y = stat(32)-1,stat(33)-1
	 return stat(32)-1,stat(33)-1
	end,
	-- return int:button [0..4]
	-- 0 .. no button
	-- 1 .. left
	-- 2 .. right
	-- 4 .. middle
	button = function()
	 return stat(34)
	end,
}
-->8
--draw
function _draw()
	cls(1)
	spr(1,mouse_x,mouse_y)
	
	for g in all(gates) do
		g:draw()
	end
end
-->8
--update
function _update()
	mouse_x,mouse_y=mouse.pos()
	mouse_btn = mouse.button()
	
	--create new gate
	if mouse_btn==1 then
		add(gates,new_gate(not_type,mouse_x,mouse_y,{},{}))
	end
end
-->8
--logic gates
--new not logic gate
--x,y are positions on screen
--ins,out are arr of other nodes
function new_gate(gate_type,x,y,ins,outs)
	g={}
	g.gate_type=gate_type
	g.x=x
	g.y=y
	g.ins=ins
	g.outs=outs
	
	g.draw=function(this)
		_str=this.gate_type.name
		_w=5+#_str*4
		_h=4+max(this.gate_type.in_n,this.gate_type.out_n)*4
		_x=this.x
		_y=this.y
		rect(_x,_y,_x+_w,_y+_h,6)
		print(_str,_x+_w/4,_y+_h/2-2,6)
		
		--ins
		for i=1,this.gate_type.in_n do
			circ(_x,_y+i*4-2,1,12)
		end
		
		--outs
		for i=1,this.gate_type.out_n do
			circ(_x+_w,_y+i*4-2,1,12)
		end
	end
	
	g.update=function(this)
	
	end
	
	return g
end
-->8
--gate types
--name=string
--truth function takes inputs
--and returns output values
--in_n=# of inputs
--out_n=# of outputs
function new_gate_type(name,tfunc,in_n,out_n)
	g={}
	g.name=name
	g.tfunc=tfunc
	g.in_n=in_n
	g.out_n=out_n
	
	g.out_values=tfunc
	
	return g
end

function not_f(ins)
	return not(ins[1])
end

function init_gate_types()
	not_type=new_gate_type("not",not_f,1,1)
end
__gfx__
00000000010000000100000000111000001111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000171000001610000000171000016666100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700177100001661000000171110111166610000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000177710001666100011177771161166610000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000177771001666610017177771016666610000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700177110001661100001777771001666100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000011710000116100000177710000111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000011100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06666660099009900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0600006091d66d190000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0600006091d66d190000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06000060099009900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
