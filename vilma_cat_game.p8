pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
function _init()
	--camera position
	cx=0
	cy=0
	--init cat position
	px=64
	py=3
	--init bee
	init_bees()
end

function _draw()
	cls(3)
	map(0,0,-cx,-cy)
	spr(1,px-cx,py-cy)--cat player
	--draw all bees
	for bee in all(bees) do
		bee:draw()
	end
end

function _update()
	input()
	--update bees
	for bee in all(bees) do
		bee:update()
	end
end

function input()
	if btn(⬅️) then
		px-=1
	end
	if btn(➡️) then
		px+=1
	end
	if btn(⬆️) then
 	py-=1
	end
	if btn(⬇️) then
	 py+=1
	end
	cx=px-64
	cy=py-64
end
-->8
--enemy
function init_bees()
	bees={}
	for i=0,100 do
		add(bees,new_bee(flr(rnd(128)),flr(rnd(128))))
	end
end

bee_speed=1--bee speed
bee_fr=8--flower radius
bee_pr=4--player radius
function new_bee(x,y)
	bee={}
	bee.n=16
	bee.x=x
	bee.y=y
	bee.tx=0
	bee.ty=0
	bee.timer=0
	--search flower in radius
	--"search"
	--goto flower in radius
	--"going"
	--pollinate flower
	--"found"
	--attack player
	--"angry"
	bee.state="search"
	
	bee.draw=function(this)
		spr(this.n,this.x-cx,this.y-cy)
		
		if	this.state=="going" then
			circ(this.tx-cx,this.ty-cy,4,14)
		end
	end
	
	bee.update=function(this)
		local mx=flr(this.x/8)
		local my=flr(this.y/8)
		
		if this.state=="search" then
			this.n=16
			this.x+=rnd(1)-0.5
			this.y+=rnd(1)-0.5
			
			for	i=0,bee_fr do 
				for	j=0,bee_fr do
					local sx=mx-bee_fr
					local sy=my-bee_fr 
					--found a flower to go to!:d
					if mget(sx+i,sy+j)==64 then
						if abs(mx-sx-i)<2 and abs(my-sy-j)<2 and rnd(1)>0.99 then
							if this.tx!=8*(sx+i) and this.ty!=8*(sy+j) then
								this.state="going"
								this.tx=8*(sx+i)
								this.ty=8*(sy+j)
								return
							end 
						end
					end
				end
			end
			
		elseif this.state=="going" then
			this.n=17
			local dx=this.tx-this.x
			local dy=this.ty-this.y
			local angle=atan2(dx,dy)
			
			local vx=bee_speed*cos(angle)
			local vy=bee_speed*sin(angle)
			
			--check if reached target
			if dx>0.5 and dy>0.5 then
				this.x+=vx
				this.y+=vy
			else
				this.state="found"
				this.timer=flr(rnd(300))
			end
		
		elseif this.state=="found" then
			this.n=18
			if this.timer>0 then
				this.timer-=1
			else
				this.state="search"
			end
				
		elseif this.state=="angry" then
			this.x+=rnd(1)-0.5
			this.y+=rnd(1)-0.5
		end	
	end
	
	return bee
end

function angle_lerp(angle1, angle2, t)
 angle1=angle1%1
 angle2=angle2%1

 if abs(angle1-angle2)>0.5 then
  if angle1>angle2 then
   angle2+=1
  else
   angle1+=1
  end
 end

 return ((1-t)*angle1+t*angle2)%1
end
__gfx__
00000000005050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000051515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700077e77000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000077777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700000dddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700707775000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000777775550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000077777050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
aaa1a1a0cac1a1a0cbc1b1b099919190000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1a11a1a1cac1a1a1cbc1b1b189819191000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
aaa1a1a0aaa1a1a0bbb1b1b099919190000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
eae00dd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0e00daad000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000daad000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a000dd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
a4a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000404000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0040404040000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4040400000000000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000040400040400000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000404040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4000000000000000000000000040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0040000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000400000000000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000040400040404000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000400040404040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000404000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000040004040004040000000404000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000004040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
