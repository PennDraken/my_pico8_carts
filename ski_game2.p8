pico-8 cartridge // http://www.pico-8.com
version 38
__lua__
function _init()
	music(0)
	_set_fps(60)
end

--player variables
player_maxspeed = 1
player_turnspeed = player_maxspeed/2
player_speed = player_maxspeed
player_n = 64
player_x = 128/2+4
player_y = 30
player_crash = false
player_width = 6
score = 0
--obstacles
function new_o(n, x, y)
	o   = {}
	o.n = n
	o.x = x
	o.y = y
	
	return o
end

o_list = {}



-->8
--draw game
function _draw()
	draw_game()
end

function draw_game()
	cls()
	--spr(1)
	draw_bg()
	draw_player()
	draw_obstacles()
	draw_score()

end

bg_id={0,1,2}
ofs=0
function draw_bg()
	ofs = (ofs - player_speed)%8
	for i=0,15 do
		for j=0,16 do
			--spr(rnd(bg_id),i*8,j*8-(player_y%8))
			spr(0,i*8,j*8+ofs-8)
		end
	end
end

function draw_o(o)
	spr(o.n,o.x,o.y)
end

function draw_obstacles()
	for i,o in pairs(o_list) do
		draw_o(o)
	end
end

function draw_player()
	if player_crash then
		spr(67,player_x,player_y)
	else
	 spr(player_n,player_x,player_y)
 end
end

function draw_score()
	print("distance:"..flr(score).."m",35,2,1)
end
-->8
--update game
function _update60()
	update_game()
end

t=0
function update_game()
	set_speed()
	if player_crash then
		player_speed *= 0.9
	else
	 input()
	end
	move_player()
	update_obstacles()
	if rnd(100) > 90 then add_object() end
	score+=player_speed/16
	t+=1
end

function set_speed()
	if score%25 == 0 then
		player_maxspeed *= 1.2
	end
end

k = 8
function input()
	--0 is left
	if btn(0) then
		player_x -= 1
		player_n = 65
		if player_speed > player_turnspeed then
			player_speed -= (abs(player_speed-player_turnspeed)/k)
		end
	--1 is right
	elseif btn(1) then
		player_x += 1
		player_n = 66
		if player_speed > player_turnspeed then
			player_speed -= (abs(player_speed-player_turnspeed)/k)
		end
	else
		player_n = 64
		if player_speed < player_maxspeed then
			player_speed += (abs(player_speed-player_maxspeed)/k)
		end
	end
end

function move_player()
	--player_y += player_speed
end

function update_obstacles()
	for i,o in pairs(o_list) do
		o.y -= player_speed
		if 
					-- left part of object
	    o.x > player_x and o.x < player_x + player_width and
	    o.y > player_y and o.y < player_y + 8 or
	    -- right part of object
	    o.x + 8 > player_x and o.x + 8< player_x + player_width and
	    o.y > player_y and o.y < player_y + 8 then
	    				
	  player_crash = true
	  player_maxspeed = 0
	  o.n = 31
	 end
		
		if o.y + 8 < 0 then
			del(o_list,o)
		end
	end
end

o_id = {16,17,18,19,20}
function add_object()
	o = new_o(rnd(o_id),rnd(128),128)
	add(o_list,o)
end


-->8
--game over
function draw_gameover()

end

function update_gameover()

end
__gfx__
66666666666666666666666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
67666666676666666666666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666766666666666666666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666766600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666666666666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000400000007000000077000000770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000004440000007000000777700007777000000000000000000000000000000000000000000000000000000000000000000000000000000000000077700
000040440444440000777000077777700777777000000000000000000000000000000000000000000000000000000000000000000000000000000000007ddd70
004444404442444000777000b7777773b77777730000000000000000000000000000000000000000000000000000000000000000000000000000000000dd6dd0
ff44400044282440077bb300bb777733ab7777b30000000000000000000000000000000000000000000000000000000000000000000000000000000000d666d0
000004000218620007bbb300bbbbbb33babbaba30000000000000000000000000000000000000000000000000000000000000000000000000000000000dd6dd0
00000040081888007bbbbb300bbbb3300bbbb3300000000000000000000000000000000000000000000000000000000000000000000000000000000000dd6dd0
00000000000000000004000000042000000420000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000ee0000ee0700000070ee000e00e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
009ff9000ff9000770009ff00e1001e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
009ff9000ff9997007999ff0e001100e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
09999990001119000091110000099000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
79111197000e110ee011e00000999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0710017000e001e00e100e000909f090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00e00e0000e00e0000e00e000909f090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00e00e000000e000000e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
311000000f0500f05012050140501605014050120500f0501c050000000000000000180500000000000000001105012050140500f050120500f0500d0500f0501505011000000000000011050000000000000000
19160000180531c0501f054180501c0501f054180501c0511c0501f050230541f050230501c0541f050210511f05323050260541f05023050260541f05028052170501305217054180501c053170541c0501f051
b716000028250185463c6551854524350000003c6550000000000000003c6551854500000000003c655000002b250185463c6551854528450000003c6550000000000000003c65518545000003c6551c3501d450
b91600000025000000000000025500250000000000000250042500000000000000000425504250000000000005250000000000005255052500000000000052570725000000000000725007255052500525504250
011600001d0511f0551c055210551d0551f0551c055210551d0551f0551c055210551d0551f0551c051210552b0512d055290552b0552b0552d055290552b0552d0552905528055260552d055290552805126055
b51600200c15324655000002465500000246550000024655000002465500000246550c1532465500000246550c15324655000002465500000246550000024655000002465500000246550c153246550000024655
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00040000276102c62038630346402e640246301b63015620116200b61008610036100260001600006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__music__
03 02030444
00 05064344

