pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
function _init()
	poke(0x5f2d, 1)--mouse
	map_table = {}
	for x = 1, 128 do
		map_table[x] = {}
		for y = 1, 128 do
			map_table[x][y] = 0 -- initialize each cell with 0 or any default value
		end
	end
end

-->8
function _draw()
 cls(0)
	spr(1,m.x,m.y)
	spr(2,m.m.x*8,m.m.y*8)
	for x=1,#map_table do
		for y=1,#map_table[x] do
			draw_tile(map_table[x][y],x,y)
		end
	end
end

function draw_tile(tile,x,y)
	if tile!=0 then
		local from=tile[1]
		local to  =tile[2]
		?to
		spr(81,x*8,y*8)
	 if from==0 then
			spr(82,x*8,y*8)
		elseif from==1 then
			spr(97,x*8,y*8)
		elseif from==2 then
			spr(80,x*8,y*8)
		elseif from==3 then
			spr(65,x*8,y*8)
		end
		
		if to==0 then
			spr(80,x*8,y*8)
		elseif to==1 then
			spr(65,x*8,y*8)
		elseif to==2 then
			spr(82,x*8,y*8)
		elseif to==3 then
			spr(97,x*8,y*8)
		end
	end
end

function is_empty_tile(tile)
    return type(tile) == "table" and
           #tile == 2 and
           type(tile[1]) == "table" and
           type(tile[2]) == "table" and
           #tile[1] == 0 and
           #tile[2] == 0
end
-->8
function _update()
	m={}
	m.x  =stat(32)
	m.y  =stat(33)
	m.btn=stat(34)
	m.m=mouse_to_map(m.x,m.y)
	if (m.btn == 1 and not last_placed) or 
   (m.btn == 1 and (last_placed.x ~= m.m.x or last_placed.y ~= m.m.y)) then
		if not last_placed then
			--first item
			last_placed={x=m.m.x,y=m.m.y}
			map_table[m.m.x][m.m.y]={{},{}}
		else
			--connecting item
			--horisontal
			if m.m.y==last_placed.y then
				if m.m.x>last_placed.x then
					--new to the right
					map_table[last_placed.x][last_placed.y][2]=1
					map_table[m.m.x][m.m.y]={{1},{3}}
					last_placed={x=m.m.x,y=m.m.y}
				else
				--new to the left
					map_table[last_placed.x][last_placed.y][2]=3
					map_table[m.m.x][m.m.y]={{3},{1}}
					last_placed={x=m.m.x,y=m.m.y}
				end
			end
			--vertical
			if m.m.x==last_placed.x then
				if m.m.y<last_placed.y then
					--new to the right
					map_table[last_placed.x][last_placed.y][2]=0
					map_table[m.m.x][m.m.y]={{0},{2}}
					last_placed={x=m.m.x,y=m.m.y}
				else
				--new to the left
					map_table[last_placed.x][last_placed.y][2]=2
					map_table[m.m.x][m.m.y]={{2},{0}}
					last_placed={x=m.m.x,y=m.m.y}
				end
			end
		end
	elseif m.btn==2 then
		last_placed=nil
		map_table[m.m.x][m.m.y]=0
	end
end

function mouse_to_map(x,y)
	return {x=flr(x/8),y=flr(y/8)}
end

--band types
--{starting squares, ending squares}
--ie...0=top,1=right,2=down,3=left
--{{0}}
__gfx__
00000000770000000600006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000700000006000000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000006000000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000600006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00777777777777777777770007777777777777700777777007777770000000000000000000000000000000000000000000000000000000000000000000000000
07eddeeedeedeedeeedeee7007edeededeedee7007eeee7007eeee70000000000000000000000000000000000000000000000000000000000000000000000000
07eeedeeedeedeedeedeed7007eedeededeede7007deed7007edde70000000000000000000000000000000000000000000000000000000000000000000000000
07eeeedeedeedeededeeed7007eedeededeede7007edde7007deed70000000000000000000000000000000000000000000000000000000000000000000000000
07ddeeeddeedeededeeede7007edeededeedee7007eeee7007eeee70000000000000000000000000000000000000000000000000000000000000000000000000
07eedee7777777777eedee70077777777777777007deed7007edde70000000000000000000000000000000000000000000000000000000000000000000000000
07eeed700000000007deee70000000000000000007edde7007deed70000000000000000000000000000000000000000000000000000000000000000000000000
07edde700000000007deed70000000000000000007deed7007edde70000000000000000000000000000000000000000000000000000000000000000000000000
07deed700077770007edde70077777777777777007edde7007deed70000000000000000000000000000000000000000000000000000000000000000000000000
07eeee7007eeee7007eeee7007eedeededeede7007eeee7007eeee70000000000000000000000000000000000000000000000000000000000000000000000000
07edde7007eeee7007deed7007edeededeedee7007deed7007edde70000000000000000000000000000000000000000000000000000000000000000000000000
07deed7007eeee7007edde7007edeededeedee7007edde7007deed70000000000000000000000000000000000000000000000000000000000000000000000000
07eeee7007eeee7007eeee7007eedeededeede7007eeee7007eeee70000000000000000000000000000000000000000000000000000000000000000000000000
07edde700077770007deed7007777777777777700777777007777770000000000000000000000000000000000000000000000000000000000000000000000000
07deed700000000007edde7000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07eeed700000000007deee7000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07eedee7777777777eedee7000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07edeeededeedeeddeeedd7000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07deeededeedeedeedeeee7000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07deedeedeedeedeeedeee7000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07eeedeeedeedeedeeedde7000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00777777777777777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
