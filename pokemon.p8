pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
function _init()
	p=p(10,10)
	cam=cam()
	t=0
end

function p(x,y)
p={
x=x,
y=y,
vx=0,
vy=0,
mspeed=1,
a=0,
draw=function(this)
	--find dir given vx vy
	local mframe=0
	if this.vx!=0 or this.vy!=0 then
		this.a=atan2(this.vx,this.vy)
		local f=20
		if t%f<f/2 then
			mframe=16
		else
			mframe=32
		end
	end
	local dir=flr(this.a*4)
	outline_spr(1+dir+mframe,p.x,p.y,1)
end,
update=function(this)
 this.vx=0
	this.vy=0
	if (btn(⬅️)) then this.vx=-this.mspeed 
	elseif (btn(➡️)) then this.vx=this.mspeed
	elseif (btn(⬆️)) then this.vy=-this.mspeed
	elseif (btn(⬇️)) then this.vy=this.mspeed
	end
	--apply movement
	this.x+=this.vx
	this.y+=this.vy
	--check collision
	--gen 4 points to check collision with
	local w=6
	local p1={flr(this.x/8)    ,flr(this.y/8)}
	local p2={flr((this.x+w)/8),flr(this.y/8)}
	local p3={flr(this.x/8)    ,flr((this.y+w)/8)}
	local p4={flr((this.x+w)/8),flr((this.y+w)/8)}
	local points={p1,p2,p3,p4}
	for point in all(points) do
		if point and fget(mget(point[1],point[2]))==1 then
			if this.vx < 0 then
       this.x = (point[1] + 1) * 8
   elseif this.vx > 0 then
       this.x = (point[1] - 1) * 8
   end

   if this.vy < 0 then
       this.y = (point[2] + 1) * 8
   elseif this.vy > 0 then
       this.y = (point[2] - 1) * 8
   end

   -- break out of the loop since we've already handled the collision
   break
		end
	end
end
}
return p
end

function cam()
	c={
	x=0,
	y=0,
	--moves cam towards x-64 y-64
	move=function(this,x,y,v)
		x-=64
		y-=64
		if (not v) v=0.5
		local a=atan2(x-this.x,y-this.y)
		local dx=cos(a)*v
		local dy=sin(a)*v
		local d=sqrt((x-this.x)^2+(y-this.y)^2)
		if d<=sqrt((x-(this.x+dx))^2+(y-(this.y+dy))^2) then
			--snap to location
			this.x=x
			this.y=y
		else
			--far away
			this.x+=dx
			this.y+=dy
		end
	end
	}
	
	
	return c
end

function outline_spr(n,x,y,c)
	if (not c) c=0
	for i=0,15 do
		pal(i,c)
	end
	spr(n,x-1,y)
	spr(n,x+1,y)
	spr(n,x,y-1)
	spr(n,x,y+1)
	pal()
	spr(n,x,y)
end
-->8
function _draw()
	camera(cam.x,cam.y)
	cls(11)
	map()
	p:draw()
	--ui
	camera()
end
-->8
function _update60()
	p:update()
	cam:move(p.x,p.y)
	t+=1
end
__gfx__
000000000009990000999000009990000099900000000000bbbbbbbb001111111111111111111100111111110000000000000000000000000000000000000000
000000000099999009999900099999000999990000000000bbbbbbbb01eff11111111111111ffe1011ffff110000000000000000000000000000000000000000
007007000999999009999900099999900999990000000000bbbbbbbb11111f777f77f7fffff11111f1f11f1f0000000000000000000000000000000000000000
000770009099f10009999900001f9909091f190000000000bbbbbbbb1111f88888888888888f111181ffff180000000000000000000000000000000000000000
00077000000ff100dd999dd0001ff000dd1f1dd000000000bbbbbbbb111f8888888888888888f111818888180000000000000000000000000000000000000000
0070070000dddd00ddddddd000dddd00ddddddd000000000bbbbbbbb11e888888888888888888e11888888880000000000000000000000000000000000000000
0000000000dddd000ddddd0000dddd000ddddd0000000000bbbbbbbb1e88888888888888888888e1888888880000000000000000000000000000000000000000
000000000001100001101100000110000110110000000000bbbbbbbb118888888888888888888811888888880000000000000000000000000000000000000000
003333000009990000999000009990000099900000000000b5b5b5b5111111111111111111111111000000000000000000000000000000000000000000000000
0333333000999990099999000999990009999900000000005555555501188881ff1111fff1111110000000000000000000000000000000000000000000000000
0333333009999990099999000999999009999900000000005555555501888888f188881f18888110000000000000000000000000000000000000000000000000
333333339099f100099999d0001f9909091f19d00000000055155515011111111888888188888810000000000000000000000000000000000000000000000000
33333333000ff100dd999dd0001ff000dd1f1dd0000000001155115101f1221f1112211111221110000000000000000000000000000000000000000000000000
1333333100dddd00dddddd0000dddd00dddddd00000000005511155501f1221fff1221fff1221f10000000000000000000000000000000000000000000000000
1113311100dddd000ddd110000dddd000ddd1100000000001511155101f1111fff1111fff1111f10000000000000000000000000000000000000000000000000
01111110000110000110000000011000011000000000000011155111011100111111111111111110000000000000000000000000000000000000000000000000
00033000000999000099900000999000009990000000000055155511000000000000000000000000000000000000000000000000000000000000000000000000
00033000009999900999990009999900099999000000000011511155000000000000000000000000000000000000000000000000000000000000000000000000
00333300099999900999990009999990099999000000000055551115000000000000000000000000000000000000000000000000000000000000000000000000
003333009099f100d9999900001f9909d91f19000000000055155515000000000000000000000000000000000000000000000000000000000000000000000000
00333300000ff100dd999dd0001ff000dd1f1dd00000000011551151000000000000000000000000000000000000000000000000000000000000000000000000
0333333000dddd000dddddd000dddd000dddddd00000000055111555000000000000000000000000000000000000000000000000000000000000000000000000
0333333000dddd00011ddd0000dddd00011ddd000000000015111551000000000000000000000000000000000000000000000000000000000000000000000000
13333331001100000000110000001100000011000000000011155111000000000000000000000000000000000000000000000000000000000000000000000000
11333311bbbbbbbb000000000000000000000000b1155511551555115515551b0000000000000000000000000000000000000000000000000000000000000000
01133110bbbbbbbb000000000000000000000000bb11115511511155115111bb0000000000000000000000000000000000000000000000000000000000000000
03311330bbbbbbbb000000000000000000000000bbb111155555111555551bbb0000000000000000000000000000000000000000000000000000000000000000
13333331bbbbbbbb000000000000000000000000bbbb1515551555155511bbbb0000000000000000000000000000000000000000000000000000000000000000
11333311bbbbbbbb000000000000000000000000bbbbb15111551151111bbbbb0000000000000000000000000000000000000000000000000000000000000000
01133110bbbbbbbb000000000000000000000000bbbbbb111111111111bbbbbb0000000000000000000000000000000000000000000000000000000000000000
00011000bbbbbbbb000000000000000000000000bbbbbbb1111111111bbbbbbb0000000000000000000000000000000000000000000000000000000000000000
00011000bbbbbbbb000000000000000000000000bbbbbbbbb1b1b1b1bbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000001010101000000000001000000000001010101000000000000000000000000010000000000000000000100000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2000000000200000070a08080900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3010000000300000171818181900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1616161616160000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2626262636360000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3636363710100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
