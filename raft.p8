pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
--init&objects
function _init()
	--water
	water_dx=0.1
	water_dy=0
	
	c=new_cam(0,0)--camera
	base={}
	add(base,new_g(1,4,4))--platforms
	p=new_p(192,30,64)--player
	items_n={64,65,66,67}
	items={}
	add(items,new_i(64,64,64))
end

--boat platform/ground
function new_g(n,x,y)
	o={}
	o.n=n
	o.x=x
	o.y=y
	
	o.draw=draw_o
	
	return o
end

--draws most objects
function draw_o(o)
	spr(o.n,o.x*8-c.x,o.y*8-c.y)
end


--items
function new_i(n,x,y)
	o={}
	o.n=n
	o.x=x
	o.y=y
	
	o.draw=function(this)
		spr(n,this.x-c.y,this.y-c.y)
	end
	
	o.update=function(this)
		this.x+=water_dx
		this.y+=water_dy
	end
	
	return o
end
-->8
--draw
function _draw()
	cls(12)
	--ocean
	
	--base
	for o in all(base) do
		o:draw()
	end
	
	--items
	for o in all(items) do
		o:draw()
	end
	
	--player
	p:draw()
end
-->8
--update
function _update()
	--generate a new random trash block
	if rnd(1)>0.99 then
		add(items,new_i(rnd(items_n),0,flr(rnd(128))))
	end

	p_input()
	
	--items
	for o in all(items) do
		o:update()
	end
	
	p:update()
end

--player input
function p_input()
	p.dx=0
	p.dy=0
	if btn(⬅️) then
		p.dx=-1
	elseif btn(➡️) then
		p.dx=1
	end
	if btn(⬆️) then
		p.dy=-1
	elseif btn(⬇️) then
		p.dy=1
	end
end
-->8
--camera
function new_cam(x,y)
	c={}
	c.x=x
	c.y=y
	--c.tx=
	return c
end
-->8
--player
--player
function new_p(n,x,y)
	p={}
	p.n=n
	p.x=x
	p.y=y
	p.w=4
	p.dx=0
	p.dy=0
	p.mv=1--max velocity
	p.states={"idle","walk","swim","interact"}
	p.state=p.states[1]--"idle"
	
	p.draw=function(this)
		_x=this.x-c.x
		_y=this.y-c.y
		if this.state=="idle" then
			spr(this.n,_x,_y)
		elseif this.state=="walk" then
			spr(this.n,_x,_y)
		elseif this.state=="swim" then
			spr(193,_x,_y)
		end
	end
	
	p.update=function(this)
		--state finder
		px1=this.x
		py1=this.y+8
		px2=this.x+8
		py2=this.y+8
		--state selector
		for o in all(base) do
			if o.x*8<px2 and o.y*8<py2 and o.x*8+8>px2 and o.y*8+8>py2 or
						o.x*8<px1 and o.y*8<py1 and o.x*8+8>px1 and o.y*8+8>py1 then
				this.state="idle"
				break
			else
				this.state="swim"
			end
		end
		
		--item pickup
		l1={x=this.x  , y=this.y}
		r1={x=this.x+8, y=this.y+8}
		l2={x=o.x     , y=o.y}
		r2={x=o.x+8   , y=o.y+8}
		for o in all(items) do
			if overlaps(l1,r1,l2,r2) then
				del(items,o)
				break
			end
		end
		
		--movement update
		this.x+=this.dx*this.mv
		this.y+=this.dy*this.mv
	end
	
	return p
end

--checks if two rectangles overlap
--rect1 (l1,r1) and (l2,r2)
function overlaps(l1,r1,l2,r2)
	--stop()
	--rectangle has area 0, no overlap
	 if l1.x > r2.x or l2.x > r1.x then
   return false
  end

  -- check if the rectangles are above/below each other
  if r1.y < l2.y or r2.y < l1.y then
   return false
  end

  return true
end
__gfx__
000000009f9f9f9f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000009f999f990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007009f9f9f9f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770009f9f9f9f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000999f9f9f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007009f9f9f9f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000009f9f999f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000009f9f9f9f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000f00f000000000000f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000f6ff6f0000000000f6f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000fff00fff00000000fff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000fff0000fff000000fff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00fff000000fff0000fff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0fff00000000fff00fff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
f6f0000000000f6ff6f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0f000000000000f00f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000ff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000ff000000ff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0ffffff0000ff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0ffffff00ffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00f00f000dddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00f00f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
