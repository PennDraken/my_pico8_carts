pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
--init
function _init()
	--world
	map_width=100
	wall_pal={64,65}
	walls=gen_world(map_width,100)
	--camera
	c=new_cam(0,0)
	--player
	p=new_p(64,64)
end

--camera
function new_cam(x,y)
	c={}
	c.x=x
	c.y=y
	return c
end

--walls (todo height)
function new_wall(n,x,y)
	w={}
	w.n=n
	w.x=x
	w.y=y
	return w
end

--returns a table of walls with defined dimensions
--w   = world width
--num = num of walls
function gen_world(w,num)
	local arr={}
	for i=0,num do
		local n=rnd(wall_pal)
		local x=flr(rnd(w))
		local y=flr(rnd(w))
		add(arr,new_wall(n,x,y))
	end
	return arr
end
-->8
--draw
function _draw()
	cls(3)
	p:draw()
	for i=1,10 do
		draw_arr(walls,8,1+i/100)
	end
end

--draws objects with depth
--s    =position scale
--depth=perspecive shift scale
function draw_arr(arr,s,depth)
	for o in all(arr) do
		local x=depth*(s*o.x-c.x-64)+64
		local y=depth*(s*o.y-c.y-64)+64		
		spr(o.n,x,y)
	end
end
-->8
--update
function _update()
	input(p)
	p:update()
	--camera snapping
	c.x=p.x-64+4
	c.y=p.y-64+4
end

--input for a given player
function input(p)
	if btnp(⬅️) then
		p.dx=-1
	elseif btnp(➡️) then
		p.dx=1
	else
		p.dx=0
	end
		
	if btnp(⬇️) then
		p.dy=1
	elseif btnp(⬆️) then
		p.dy=-1
	else
		p.dy=0
	end
end
-->8
--player
function new_p(x,y)
	p={}
	p.x=x--position
	p.y=y
	p.dx=0--direction
	p.dy=0
	p.sx=0--speed/velocity
	p.sy=0
	p.maxs=1--maxspeed
	p.a=0.3
	
	p.update=function(this)
		local p=this
		--speed calculation
		--norm_speed=sqrt(p.sx^2+p.sy^2)
		p.sx+=p.dx*p.a
		p.sy+=p.dy*p.a
		
		--position calculation
		p.x+=p.sx
		p.y+=p.sy
		this=p
	end
	
	p.draw=function(this)
		spr(128,this.x-c.x,this.y-c.y)
	end
	return p
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
166666611ffffff10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
d66666662fffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
d66666662fffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
d66666662fffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
d66666662fffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
d66666662fffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
d66666662fffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1dddddd1122222210000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d666760000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5d666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5d666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5dd66660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55dddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02222222220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00222222220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
